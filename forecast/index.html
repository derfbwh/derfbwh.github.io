<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2024 US Presidential Election Forecast</title>
    <style>
    @import url("https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@200;400;600;700;800&display=swap");
    @import url("https://use.typekit.net/htk2wjy.css");
        body {
            font-family: JetBrains Mono, sans-serif;
            margin: 20px;
        }
        h1 {
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        #mappyLogo {
            width: 50px; /* Set Mappy width to 50 pixels */
            height: auto; /* Maintain aspect ratio */
            vertical-align: middle;
        }
        .container {
            max-width: 1024px;
            margin: 0 auto;
        }
        .results-container {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-bottom: 20px;
        }
        .results {
            flex: 1 1 100%;
            padding: 15px;
            background-color: #f8f9fa;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        .results h2 {
            margin-top: 0;
        }
        .results:nth-of-type(2),
        .results:nth-of-type(3) {
            flex: 1;
        }
        table {
            width: 100%;
            margin-top: 20px;
            border-collapse: collapse;
            border: 1px solid #ddd;
        }
        th, td {
            padding: 10px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        th {
            background-color: #f2f2f2;
        }
        svg {
            width: 100%;
            height: auto;
            margin-top: 20px;
        }
        .state {
            stroke: #000;
            stroke-width: 0.5;
        }

        /* Media Queries */
        @media (max-width: 768px) {
            .results-container {
                flex-direction: column;
            }
            .results:nth-of-type(1) {
                margin-bottom: 20px; /* Add spacing between stacked items */
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>
            <svg id="mappyLogo" viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg">
                <!-- Toilet Base -->
                <rect x="8" y="40" width="48" height="12" fill="#ddd" stroke="#999" stroke-width="2"/>
                <!-- Toilet Bowl -->
                <rect x="16" y="20" width="32" height="20" rx="5" ry="5" fill="#ccc" stroke="#999" stroke-width="2"/>
                <!-- Toilet Tank -->
                <rect x="20" y="10" width="24" height="10" rx="4" ry="4" fill="#ccc" stroke="#999" stroke-width="2"/>
                <!-- Toilet Lid -->
                <rect x="22" y="8" width="20" height="4" rx="2" ry="2" fill="#eee" stroke="#999" stroke-width="2"/>
                <!-- Flush Handle -->
                <line x1="46" y1="12" x2="50" y2="16" stroke="#999" stroke-width="2"/>
                <!-- Toilet Seat -->
                <ellipse cx="32" cy="30" rx="16" ry="8" fill="#fff" stroke="#999" stroke-width="2"/>
            </svg>
            2024 US Presidential Election Forecast
        </h1>
        
        <div class="results-container">
            <div class="results">
                <h2>Overall Chance of Winning the Electoral College</h2>
                <p id="harrisChance">Kamala Harris: 0%</p>
                <p id="trumpChance">Donald Trump: 0%</p>
            </div>

            <div class="results">
                <h2>Electoral Votes</h2>
                <p id="harrisVotes">Kamala Harris: 0 Electoral Votes</p>
                <p id="trumpVotes">Donald Trump: 0 Electoral Votes</p>
            </div>

            <div class="results">
                <h2>Odds of an upset are about the odds of...</h2>
                <p id="upsetOdds">Comparison will be displayed here.</p>
            </div>
        </div>

        <table id="pollTable">
            <thead>
                <tr>
                    <th>State</th>
                    <th>Electoral Votes</th>
                    <th>Kamala Harris (D)</th>
                    <th>Donald Trump (R)</th>
                    <th>Winner</th>
                </tr>
            </thead>
            <tbody id="pollBody">
                <!-- Rows will be dynamically populated -->
            </tbody>
        </table>

        <svg id="usMap" viewBox="0 0 1000 600"></svg>
    </div>



<script>
    const electionDate = new Date('2024-11-06'); // Election Day
    const today = new Date(); // Current Date
    const daysUntilElection = Math.max(0, (electionDate - today) / (1000 * 60 * 60 * 24)); // Days left

    // Backend-like data storage for swing states
    const pollData = [
        { state: 'Florida', electoralVotes: 30, harris: 43.3, trump: 47.8 },
        { state: 'Pennsylvania', electoralVotes: 19, harris: 46.3, trump: 44.8 },
        { state: 'Wisconsin', electoralVotes: 10, harris: 47.4, trump: 44.1 },
        { state: 'Michigan', electoralVotes: 15, harris: 46.5, trump: 43.3 },
        { state: 'Arizona', electoralVotes: 11, harris: 45.3, trump: 44.4 },
        { state: 'Georgia', electoralVotes: 16, harris: 46.7, trump: 45.2 },
        { state: 'Nevada', electoralVotes: 6, harris: 47.0, trump: 45.0 },
        { state: 'North Carolina', electoralVotes: 15, harris: 45.0, trump: 46.0 }
    ];

    // Electoral votes based on the 2020 election results for non-swing states
    const nonSwingStates = {
        'Harris': 212, // States that went to Biden (Democrat)
        'Trump': 126   // States that went to Trump (Republican)
    };

    const totalElectoralVotes = 538; // Total electoral votes available
    const winningThreshold = 270; // Votes needed to win the election

    function calculateElectoralVotes() {
        let harrisVotes = nonSwingStates.Harris;
        let trumpVotes = nonSwingStates.Trump;

        // Loop through each swing state to determine the winner and accumulate electoral votes
        pollData.forEach(state => {
            let adjustedHarris = state.harris;
            let adjustedTrump = state.trump;

            // Simulate possible fluctuations based on time left until Election Day
            const maxFluctuation = 8; // Max percentage fluctuation
            const minFluctuation = 2; // Min percentage fluctuation
            const fluctuationRange = maxFluctuation - minFluctuation;
            const uncertaintyFactor = Math.min(1, daysUntilElection / 365); // 1 year = 365 days

            // Randomly adjust the poll numbers based on the time left until Election Day
            const fluctuation = Math.random() * fluctuationRange + minFluctuation;
            const harrisFluctuation = (Math.random() < 0.5 ? -1 : 1) * fluctuation * uncertaintyFactor;
            const trumpFluctuation = (Math.random() < 0.5 ? -1 : 1) * fluctuation * uncertaintyFactor;

            adjustedHarris = Math.min(100, Math.max(0, adjustedHarris + harrisFluctuation));
            adjustedTrump = Math.min(100, Math.max(0, adjustedTrump + trumpFluctuation));

            let winner = '';

            if (adjustedHarris > adjustedTrump) {
                harrisVotes += state.electoralVotes;
                winner = 'Kamala Harris';
            } else if (adjustedTrump > adjustedHarris) {
                trumpVotes += state.electoralVotes;
                winner = 'Donald Trump';
            } else {
                // If there's a tie, split the votes (not realistic but keeps it simple)
                harrisVotes += state.electoralVotes / 2;
                trumpVotes += state.electoralVotes / 2;
                winner = 'Tie';
            }

            document.getElementById(state.state).textContent = winner;
        });

        document.getElementById('harrisVotes').textContent = `Kamala Harris: ${harrisVotes.toFixed(0)} Electoral Votes`;
        document.getElementById('trumpVotes').textContent = `Donald Trump: ${trumpVotes.toFixed(0)} Electoral Votes`;

        calculateWinProbability(harrisVotes, trumpVotes);
        updateMap();
    }

    function calculateWinProbability(harrisVotes, trumpVotes) {
        let harrisChance = 0;
        let trumpChance = 0;

        // Calculate the chances of each candidate winning based on the votes
        if (harrisVotes >= winningThreshold) {
            harrisChance = 100;
        } else {
            harrisChance = (harrisVotes / winningThreshold) * 100;
        }

        if (trumpVotes >= winningThreshold) {
            trumpChance = 100;
        } else {
            trumpChance = (trumpVotes / winningThreshold) * 100;
        }

        // Adjust the probabilities so they add up to 100%
        const totalChance = harrisChance + trumpChance;
        harrisChance = (harrisChance / totalChance) * 100;
        trumpChance = (trumpChance / totalChance) * 100;

        document.getElementById('harrisChance').textContent = `Kamala Harris: ${harrisChance.toFixed(2)}%`;
        document.getElementById('trumpChance').textContent = `Donald Trump: ${trumpChance.toFixed(2)}%`;

        determineUpsetOdds(harrisChance, trumpChance);
    }

    function determineUpsetOdds(harrisChance, trumpChance) {
        const comparisons = [
            { text: "drawing a specific card from a full deck of 52 cards", odds: 1 / 52 },
            { text: "winning a small lottery prize", odds: 1 / 50 },
            { text: "finding a $20 bill on the ground", odds: 1 / 50 },
            { text: "hitting a hole-in-one in mini golf (trickier course)", odds: 1 / 50 },
            { text: "winning a free ticket in a scratch-off lottery", odds: 1 / 20 },
            { text: "making a successful free throw in basketball (average player)", odds: 1 / 10 },
            { text: "correctly guessing a random 3-digit number", odds: 1 / 1000 },
            { text: "scoring a goal in a non-professional soccer match", odds: 1 / 10 },
            { text: "drawing a face card from a deck of 52 cards", odds: 3 / 52 },
            { text: "hitting a bullseye in darts (intermediate player)", odds: 1 / 10 },
            { text: "drawing a full house in Poker", odds: 1 / 40 },
            { text: "hitting a home run in a baseball game (professional player)", odds: 1 / 20 },
            { text: "flipping a coin and getting heads or tails (50/50)", odds: 1 / 2 },
            { text: "a WNBA player making a three-point shot", odds: 1 / 3 },
            { text: "getting a full house in Poker", odds: 1 / 40 },
            { text: "finding a $100 bill on the ground", odds: 1 / 50 }
        ];

        let upsetChance = Math.min(harrisChance, trumpChance);

        let closestComparison = comparisons.reduce((prev, curr) => {
            return (Math.abs(curr.odds * 100 - upsetChance) < Math.abs(prev.odds * 100 - upsetChance) ? curr : prev);
        });

        document.getElementById('upsetOdds').textContent = `Odds of an upset are about the odds of ${closestComparison.text}.`;
    }

    function populateTable() {
        const pollBody = document.getElementById('pollBody');

        pollData.forEach(state => {
            const row = document.createElement('tr');

            const stateCell = document.createElement('td');
            stateCell.textContent = state.state;

            const electoralVotesCell = document.createElement('td');
            electoralVotesCell.textContent = state.electoralVotes;

            const harrisCell = document.createElement('td');
            harrisCell.textContent = `${state.harris}%`;

            const trumpCell = document.createElement('td');
            trumpCell.textContent = `${state.trump}%`;

            const winnerCell = document.createElement('td');
            winnerCell.id = state.state;

            row.appendChild(stateCell);
            row.appendChild(electoralVotesCell);
            row.appendChild(harrisCell);
            row.appendChild(trumpCell);
            row.appendChild(winnerCell);

            pollBody.appendChild(row);
        });
    }

    function updateMap() {
        pollData.forEach(state => {
            let adjustedHarris = state.harris;
            let adjustedTrump = state.trump;

            // Simulate possible fluctuations
            const maxFluctuation = 8; // Max percentage fluctuation
            const minFluctuation = 2; // Min percentage fluctuation
            const fluctuationRange = maxFluctuation - minFluctuation;
            const uncertaintyFactor = Math.min(1, daysUntilElection / 365); // 1 year = 365 days

            // Randomly adjust the poll numbers based on the time left until Election Day
            const fluctuation = Math.random() * fluctuationRange + minFluctuation;
            const harrisFluctuation = (Math.random() < 0.5 ? -1 : 1) * fluctuation * uncertaintyFactor;
            const trumpFluctuation = (Math.random() < 0.5 ? -1 : 1) * fluctuation * uncertaintyFactor;

            adjustedHarris = Math.min(100, Math.max(0, adjustedHarris + harrisFluctuation));
            adjustedTrump = Math.min(100, Math.max(0, adjustedTrump + trumpFluctuation));

            let color = '#ccc'; // Default color for undecided

            if (adjustedHarris > adjustedTrump) {
                const intensity = Math.min(1, adjustedHarris / 100);
                color = `rgba(0, 0, 255, ${intensity})`; // Blue for Harris
            } else if (adjustedTrump > adjustedHarris) {
                const intensity = Math.min(1, adjustedTrump / 100);
                color = `rgba(255, 0, 0, ${intensity})`; // Red for Trump
            }

            // Find the state path by its data-ID
            const statePath = document.querySelector(`path[data-ID="${state.state}"]`);
            if (statePath) {
                statePath.style.fill = color;
            } else {
                console.error(`No path found for state ID: ${state.state}`);
            }
        });
    }

    // Initialize the page
    populateTable();
    calculateElectoralVotes();
</script>
</body>
</html>
